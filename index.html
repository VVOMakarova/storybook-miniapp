<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Storybook Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #0f172a;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 16px;
      min-height: 100vh;
      background: radial-gradient(circle at 10% 20%, #c2f0ff 0, #9de1ff 25%, #77cffc 60%, #5ab8f5 100%);
      position: relative;
      overflow-x: hidden;
    }

    /* –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—É–∑—ã—Ä–∏ –Ω–∞ —Ñ–æ–Ω–µ (–Ω–µ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) */
    .decor-bubbles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -1;
    }
    .decor-bubble {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0));
      border: 1px solid rgba(255,255,255,0.9);
      opacity: 0.55;
      filter: blur(0.5px);
    }
    .decor-bubble--1 { width: 140px; height: 140px; top: 6%;  left: 6%; }
    .decor-bubble--2 { width: 110px; height: 110px; top: 18%; right: 10%; }
    .decor-bubble--3 { width: 90px;  height: 90px;  bottom: 18%; left: 15%; }
    .decor-bubble--4 { width: 160px; height: 160px; bottom: -30px; right: -10px; opacity: 0.4; }
    .decor-bubble--5 { width: 70px;  height: 70px;  top: 50%; left: 55%; opacity: 0.45; }

    .container {
      max-width: 480px;
      margin: 0 auto;
    }

    .bubble-card {
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.95), rgba(255,255,255,0.78));
      border-radius: 32px;
      padding: 18px 16px 20px;
      box-shadow:
        0 18px 40px rgba(15,23,42,0.35),
        0 0 0 1px rgba(255,255,255,0.7);
      backdrop-filter: blur(12px);
    }

    .hero {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 8px;
    }
    .hero-illustration {
      width: 84px;
      height: 84px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffe0f2 0, #ffb6dd 45%, #ff9fd6 80%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 8px 18px rgba(244,114,182,0.5),
        0 0 0 3px rgba(255,255,255,0.8);
      overflow: hidden;
    }
    .hero-emoji {
      font-size: 40px;
      line-height: 1;
      transform: translateY(2px);
    }

    .hero-text {
      flex: 1;
      min-width: 0;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 4px;
    }
    p.description {
      font-size: 13px;
      margin: 0;
      color: #4b5563;
    }

    .lang-switch {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 10px;
    }
    .lang-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.8);
      background: rgba(255,255,255,0.9);
      padding: 4px 12px;
      font-size: 11px;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(15,23,42,0.15);
      transition: all 0.18s ease;
      color: #000000; /* —Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ —á—ë—Ä–Ω—ã–π */
    }
    .lang-btn--active {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #000000; /* —á—ë—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–≤–µ—Ä—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
      border-color: transparent;
      box-shadow:
        0 4px 10px rgba(79,70,229,0.55),
        0 0 0 1px rgba(255,255,255,0.8) inset;
    }

    form {
      margin-top: 10px;
    }

    .field {
      margin-bottom: 12px;
      padding: 8px 10px 10px;
      border-radius: 18px;
      background: radial-gradient(circle at 15% 10%, rgba(255,255,255,0.98), rgba(255,255,255,0.78));
      box-shadow:
        0 6px 12px rgba(15,23,42,0.12),
        0 0 0 1px rgba(255,255,255,0.85);
    }

    label {
      display: block;
      font-size: 12px;
      margin-bottom: 4px;
      color: #334155;
    }

    .field-hint {
      display: block;
      margin-top: 4px;
      font-size: 11px;
      color: #6b7280;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 13px;
      outline: none;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 2px 4px rgba(15,23,42,0.05) inset;
    }
    textarea {
      border-radius: 18px;
      resize: vertical;
      min-height: 60px;
    }
    input::placeholder,
    textarea::placeholder {
      color: #9ca3af;
    }
    input:focus,
    select:focus,
    textarea:focus {
      border-color: #6366f1;
      box-shadow:
        0 0 0 1px rgba(129,140,248,0.6),
        0 0 0 4px rgba(129,140,248,0.26);
      background: #ffffff;
    }

    button {
      width: 100%;
      padding: 11px 16px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: radial-gradient(circle at 20% 0, #a5b4fc, #6366f1);
      color: #ffffff;
      box-shadow:
        0 10px 20px rgba(79,70,229,0.55),
        0 0 0 1px rgba(255,255,255,0.9) inset;
      margin-top: 4px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }
    button:active {
      transform: translateY(1px);
      box-shadow:
        0 6px 14px rgba(79,70,229,0.55),
        0 0 0 1px rgba(255,255,255,0.9) inset;
      filter: brightness(0.98);
    }
    button:disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow:
        0 4px 8px rgba(148,163,184,0.5),
        0 0 0 1px rgba(255,255,255,0.9) inset;
    }

    .note {
      font-size: 11px;
      color: #475569;
      margin-top: 8px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="decor-bubbles">
    <span class="decor-bubble decor-bubble--1"></span>
    <span class="decor-bubble decor-bubble--2"></span>
    <span class="decor-bubble decor-bubble--3"></span>
    <span class="decor-bubble decor-bubble--4"></span>
    <span class="decor-bubble decor-bubble--5"></span>
  </div>

  <main class="container">
    <div class="bubble-card">
      <div class="lang-switch">
        <button type="button" class="lang-btn lang-btn--active" data-lang="ru">RU</button>
        <button type="button" class="lang-btn" data-lang="en">EN</button>
      </div>

      <div class="hero">
        <div class="hero-illustration">
          <span class="hero-emoji">üìñ</span>
        </div>
        <div class="hero-text">
          <h1 id="title">–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É</h1>
          <p class="description" id="description">
            –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –±–æ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å–∫–∞–∑–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –µ—ë –≤ —á–∞—Ç –≤ –≤–∏–¥–µ PDF-–∫–Ω–∏–≥–∏.
          </p>
        </div>
      </div>

      <form id="storyForm">
        <div class="field">
          <label for="child_name" id="label_child_name">–ò–º—è –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è *</label>
          <input id="child_name" name="child_name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ê—Ä–∏–Ω–∞" />
        </div>

        <div class="field">
          <label for="main_character_photo" id="label_main_photo">–§–æ—Ç–æ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input id="main_character_photo" name="main_character_photo" type="file" accept="image/*" />
          <small class="field-hint" id="hint_main_photo">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–Ω–∏–º–æ–∫.</small>
        </div>

        <div class="field">
          <label for="second_character_name" id="label_second_character_name">–ò–º—è –≤—Ç–æ—Ä–æ–≥–æ –≥–µ—Ä–æ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input id="second_character_name" name="second_character_name" placeholder="–ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º" />
        </div>

        <div class="field">
          <label for="second_character_photo" id="label_second_photo">–§–æ—Ç–æ –≤—Ç–æ—Ä–æ–≥–æ –≥–µ—Ä–æ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input id="second_character_photo" name="second_character_photo" type="file" accept="image/*" />
          <small class="field-hint" id="hint_second_photo">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–Ω–∏–º–æ–∫.</small>
        </div>

        <div class="field">
          <label for="narrative_style" id="label_narrative_style">–°—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è *</label>
          <select id="narrative_style" name="narrative_style" required>
            <option value="gentle_meditative">–°–ø–æ–∫–æ–π–Ω—ã–π –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π</option>
            <option value="adventurous">–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–π</option>
            <option value="mysterious">–ó–∞–≥–∞–¥–æ—á–Ω—ã–π</option>
            <option value="humorous">–° —é–º–æ—Ä–æ–º</option>
            <option value="lyrical">–õ–∏—Ä–∏—á–µ—Å–∫–∏–π</option>
          </select>
        </div>

        <div class="field">
          <label for="educational_plot" id="label_educational_plot">–ü–æ—É—á–∏—Ç–µ–ª—å–Ω—ã–π —Å—é–∂–µ—Ç *</label>
          <select id="educational_plot" name="educational_plot" required>
            <option value="kindness_help">–î–æ–±—Ä–æ—Ç–∞ –∏ –ø–æ–º–æ—â—å –¥—Ä—É–≥–∏–º</option>
            <option value="power_of_friendship">–°–∏–ª–∞ –¥—Ä—É–∂–±—ã</option>
            <option value="honesty_trust">–ß–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –¥–æ–≤–µ—Ä–∏–µ</option>
            <option value="accepting_differences">–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–∞–∑–ª–∏—á–∏–π</option>
            <option value="admitting_mistakes">–£–º–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å –æ—à–∏–±–∫–∏</option>
            <option value="patience_perseverance">–¢–µ—Ä–ø–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å</option>
            <option value="care_for_nature">–ó–∞–±–æ—Ç–∞ –æ –ø—Ä–∏—Ä–æ–¥–µ</option>
            <option value="safety_caution">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å</option>
            <option value="respect_parents_adults">–£–≤–∞–∂–µ–Ω–∏–µ –∫ —Ä–æ–¥–∏—Ç–µ–ª—è–º –∏ –≤–∑—Ä–æ—Å–ª—ã–º</option>
            <option value="sharing">–£–º–µ–Ω–∏–µ –¥–µ–ª–∏—Ç—å—Å—è</option>
            <option value="independence_responsibility">–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</option>
            <option value="emotions_expression">–≠–º–æ—Ü–∏–∏ –∏ —É–º–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç—å –æ –Ω–∏—Ö</option>
            <option value="anti_bullying">–ü—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ –±—É–ª–ª–∏–Ω–≥—É</option>
            <option value="value_of_work">–¶–µ–Ω–Ω–æ—Å—Ç—å —Ç—Ä—É–¥–∞</option>
            <option value="tidiness_order">–ê–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫</option>
            <option value="gadgets_moderation">–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –≥–∞–¥–∂–µ—Ç–∞—Ö</option>
            <option value="gratitude">–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å</option>
            <option value="imagination_creativity">–í–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ</option>
          </select>
        </div>

        <div class="field">
          <label for="setting" id="label_setting">–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input id="setting" name="setting" placeholder="–õ–µ—Å, –º–æ—Ä–µ, –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥‚Ä¶" />
        </div>

        <div class="field">
          <label for="language" id="label_language">–Ø–∑—ã–∫ —Å–∫–∞–∑–∫–∏ *</label>
          <select id="language" name="language" required>
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
          </select>
        </div>

        <div class="field">
          <label for="age_group" id="label_age_group">–í–æ–∑—Ä–∞—Å—Ç —Ä–µ–±—ë–Ω–∫–∞ *</label>
          <select id="age_group" name="age_group" required>
            <option value="toddler">1‚Äì3 –≥–æ–¥–∞</option>
            <option value="preschool" selected>4‚Äì6 –ª–µ—Ç</option>
            <option value="primary">7‚Äì9 –ª–µ—Ç</option>
            <option value="preteen">10‚Äì12 –ª–µ—Ç</option>
          </select>
        </div>

        <button type="submit" id="submitBtn">–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É</button>
        <p class="note" id="note">
          –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –ø–æ—Å–ª–µ —Ñ–æ—Ä–º—ã ‚Äî –æ–Ω —Å–≤—è–∂–µ—Ç –∏—Ö —Å —ç—Ç–æ–π —Å–∫–∞–∑–∫–æ–π. –ó–æ–Ω—ã –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ –≤—ã—à–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã.
        </p>
      </form>
    </div>
  </main>

  <script>
    const tg = window.Telegram.WebApp || null;
    if (tg) {
      tg.ready();
      tg.expand();
    }

    const form = document.getElementById('storyForm');
    const submitBtn = document.getElementById('submitBtn');

    const translations = {
      ru: {
        title: '–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É',
        description: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –±–æ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å–∫–∞–∑–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –µ—ë –≤ —á–∞—Ç –≤ –≤–∏–¥–µ PDF-–∫–Ω–∏–≥–∏.',
        child_name_label: '–ò–º—è –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è *',
        child_name_placeholder: '–ù–∞–ø—Ä–∏–º–µ—Ä, –ê—Ä–∏–Ω–∞',
        main_photo_label: '–§–æ—Ç–æ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)',
        main_photo_hint: '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–Ω–∏–º–æ–∫.',
        second_character_label: '–ò–º—è –≤—Ç–æ—Ä–æ–≥–æ –≥–µ—Ä–æ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)',
        second_character_placeholder: '–ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º',
        second_photo_label: '–§–æ—Ç–æ –≤—Ç–æ—Ä–æ–≥–æ –≥–µ—Ä–æ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)',
        second_photo_hint: '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–Ω–∏–º–æ–∫.',
        educational_plot_label: '–ü–æ—É—á–∏—Ç–µ–ª—å–Ω—ã–π —Å—é–∂–µ—Ç *',
        educational_plot_options: {
          kindness_help: '–î–æ–±—Ä–æ—Ç–∞ –∏ –ø–æ–º–æ—â—å –¥—Ä—É–≥–∏–º',
          power_of_friendship: '–°–∏–ª–∞ –¥—Ä—É–∂–±—ã',
          honesty_trust: '–ß–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –¥–æ–≤–µ—Ä–∏–µ',
          accepting_differences: '–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–∞–∑–ª–∏—á–∏–π',
          admitting_mistakes: '–£–º–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å –æ—à–∏–±–∫–∏',
          patience_perseverance: '–¢–µ—Ä–ø–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å',
          care_for_nature: '–ó–∞–±–æ—Ç–∞ –æ –ø—Ä–∏—Ä–æ–¥–µ',
          safety_caution: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å',
          respect_parents_adults: '–£–≤–∞–∂–µ–Ω–∏–µ –∫ —Ä–æ–¥–∏—Ç–µ–ª—è–º –∏ –≤–∑—Ä–æ—Å–ª—ã–º',
          sharing: '–£–º–µ–Ω–∏–µ –¥–µ–ª–∏—Ç—å—Å—è',
          independence_responsibility: '–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å',
          emotions_expression: '–≠–º–æ—Ü–∏–∏ –∏ —É–º–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç—å –æ –Ω–∏—Ö',
          anti_bullying: '–ü—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ –±—É–ª–ª–∏–Ω–≥—É',
          value_of_work: '–¶–µ–Ω–Ω–æ—Å—Ç—å —Ç—Ä—É–¥–∞',
          tidiness_order: '–ê–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫',
          gadgets_moderation: '–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –≥–∞–¥–∂–µ—Ç–∞—Ö',
          gratitude: '–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å',
          imagination_creativity: '–í–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ'
        },
        narrative_style_label: '–°—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è *',
        narrative_style_options: {
          gentle_meditative: '–°–ø–æ–∫–æ–π–Ω—ã–π –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π',
          adventurous: '–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–π',
          mysterious: '–ó–∞–≥–∞–¥–æ—á–Ω—ã–π',
          humorous: '–° —é–º–æ—Ä–æ–º',
          lyrical: '–õ–∏—Ä–∏—á–µ—Å–∫–∏–π'
        },
        setting_label: '–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)',
        setting_placeholder: '–õ–µ—Å, –º–æ—Ä–µ, –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥‚Ä¶',
        language_label: '–Ø–∑—ã–∫ —Å–∫–∞–∑–∫–∏ *',
        language_options: {
          ru: '–†—É—Å—Å–∫–∏–π',
          en: 'English'
        },
        age_group_label: '–í–æ–∑—Ä–∞—Å—Ç —Ä–µ–±—ë–Ω–∫–∞ *',
        age_group_options: {
          toddler: '1‚Äì3 –≥–æ–¥–∞',
          preschool: '4‚Äì6 –ª–µ—Ç',
          primary: '7‚Äì9 –ª–µ—Ç',
          preteen: '10‚Äì12 –ª–µ—Ç'
        },
        submit: '–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É',
        note: '–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –ø–æ—Å–ª–µ —Ñ–æ—Ä–º—ã ‚Äî –æ–Ω —Å–≤—è–∂–µ—Ç –∏—Ö —Å —ç—Ç–æ–π —Å–∫–∞–∑–∫–æ–π. –ó–æ–Ω—ã –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ –≤—ã—à–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã.'
      },
      en: {
        title: 'Create a story',
        description: 'Fill in the fields ‚Äî the bot will generate a personalised story and send it to the chat as a PDF book.',
        child_name_label: 'Main character‚Äôs name *',
        child_name_placeholder: 'For example, Arina',
        main_photo_label: 'Main character photo (optional)',
        main_photo_hint: 'Choose a picture or take a photo.',
        second_character_label: 'Second character‚Äôs name (optional)',
        second_character_placeholder: 'You may leave this empty',
        second_photo_label: 'Second character photo (optional)',
        second_photo_hint: 'Choose a picture or take a photo.',
        educational_plot_label: 'Educational plot *',
        educational_plot_options: {
          kindness_help: 'Kindness and helping others',
          power_of_friendship: 'Power of friendship',
          honesty_trust: 'Honesty and trust',
          accepting_differences: 'Accepting differences',
          admitting_mistakes: 'Admitting mistakes',
          patience_perseverance: 'Patience and perseverance',
          care_for_nature: 'Caring for nature',
          safety_caution: 'Safety and caution',
          respect_parents_adults: 'Respect for parents and adults',
          sharing: 'Sharing with others',
          independence_responsibility: 'Independence and responsibility',
          emotions_expression: 'Emotions and talking about them',
          anti_bullying: 'Standing up to bullying',
          value_of_work: 'Value of work',
          tidiness_order: 'Tidiness and order',
          gadgets_moderation: 'Moderation with gadgets',
          gratitude: 'Gratitude',
          imagination_creativity: 'Imagination and creativity'
        },
        narrative_style_label: 'Narrative style *',
        narrative_style_options: {
          gentle_meditative: 'Gentle, meditative',
          adventurous: 'Adventurous',
          mysterious: 'Mysterious',
          humorous: 'Humorous',
          lyrical: 'Lyrical'
        },
        setting_label: 'Setting (optional)',
        setting_placeholder: 'Forest, sea, space city‚Ä¶',
        language_label: 'Story language *',
        language_options: {
          ru: 'Russian',
          en: 'English'
        },
        age_group_label: 'Child‚Äôs age *',
        age_group_options: {
          toddler: '1‚Äì3 years',
          preschool: '4‚Äì6 years',
          primary: '7‚Äì9 years',
          preteen: '10‚Äì12 years'
        },
        submit: 'Create story',
        note: 'You can send photos to the bot as separate messages after submitting the form ‚Äî they will be linked to this story. The photo selection areas above are optional.'
      }
    };

    let currentLang = 'ru';

    function applyTranslations(lang) {
      const t = translations[lang];
      currentLang = lang;
      document.documentElement.lang = lang;

      document.getElementById('title').textContent = t.title;
      document.getElementById('description').textContent = t.description;

      document.getElementById('label_child_name').textContent = t.child_name_label;
      document.getElementById('label_main_photo').textContent = t.main_photo_label;
      document.getElementById('hint_main_photo').textContent = t.main_photo_hint;
      document.getElementById('label_second_character_name').textContent = t.second_character_label;
      document.getElementById('hint_second_photo').textContent = t.second_photo_hint;
      document.getElementById('label_second_photo').textContent = t.second_photo_label;
      document.getElementById('label_educational_plot').textContent = t.educational_plot_label;
      document.getElementById('label_narrative_style').textContent = t.narrative_style_label;
      document.getElementById('label_setting').textContent = t.setting_label;
      document.getElementById('label_language').textContent = t.language_label;
      document.getElementById('label_age_group').textContent = t.age_group_label;

      form.child_name.placeholder = t.child_name_placeholder;
      form.second_character_name.placeholder = t.second_character_placeholder;
      form.setting.placeholder = t.setting_placeholder;

      const educationalSelect = form.educational_plot;
      for (const option of educationalSelect.options) {
        const key = option.value;
        if (t.educational_plot_options[key]) {
          option.textContent = t.educational_plot_options[key];
        }
      }

      const narrativeSelect = form.narrative_style;
      for (const option of narrativeSelect.options) {
        const key = option.value;
        if (t.narrative_style_options[key]) {
          option.textContent = t.narrative_style_options[key];
        }
      }

      const languageSelect = form.language;
      for (const option of languageSelect.options) {
        const key = option.value;
        if (t.language_options[key]) {
          option.textContent = t.language_options[key];
        }
      }

      const ageSelect = form.age_group;
      for (const option of ageSelect.options) {
        const key = option.value;
        if (t.age_group_options[key]) {
          option.textContent = t.age_group_options[key];
        }
      }

      submitBtn.textContent = t.submit;
      document.getElementById('note').textContent = t.note;

      if (lang === 'ru' || lang === 'en') {
        form.language.value = lang;
      }
    }

    const langButtons = document.querySelectorAll('.lang-btn');
    langButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const lang = btn.dataset.lang;
        if (lang === currentLang) return;
        langButtons.forEach((b) => {
          b.classList.toggle('lang-btn--active', b === btn);
        });
        applyTranslations(lang);
      });
    });

    applyTranslations('ru');

    form.addEventListener('submit', function (event) {
      event.preventDefault();
      submitBtn.disabled = true;

      const data = {
        child_name: form.child_name.value.trim(),
        second_character_name: form.second_character_name.value.trim() || null,
        educational_plot: form.educational_plot.value,
        narrative_style: form.narrative_style.value,
        setting: form.setting.value.trim() || null,
        language: form.language.value,
        age_group: form.age_group.value,
        ui_language: currentLang,
        main_character_photo_name: form.main_character_photo.files[0]?.name || null,
        second_character_photo_name: form.second_character_photo.files[0]?.name || null
      };

      try {
        if (tg) {
          tg.sendData(JSON.stringify(data));
          tg.close();
        } else {
          // —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ
          alert('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:\n' + JSON.stringify(data, null, 2));
          submitBtn.disabled = false;
        }
      } catch (e) {
        console.error(e);
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
